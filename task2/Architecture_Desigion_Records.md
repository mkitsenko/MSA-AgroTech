### <a name="_b7urdng99y53"></a>**Название задачи:** Задача 2
### <a name="_hjk0fkfyohdk"></a>**Автор:**
### <a name="_uanumrh8zrui"></a>**Дата:**
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

| **Функциональные требования**                                                                                                                                                                                                                  |
|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Система фиксирует признаки беспокойного поведения или драк среди животных и оповещать оператора                                                                                                                                                |
| Система фиксирует признаки задавливания поросят                                                                                                                                                                                                |
| Система управляет кормушками и поилками разных производителей                                                                                                                                                                                  |
| Система оценивает состояние животных по внешнему виду и поведению: болезнь, гибель, беспокойство и так далее                                                                                                                                   |
| Система следит за состоянием систем фильтрации воды                                                                                                                                                                                            |
| Система пересчитывает поголовье                                                                                                                                                                                                                |
| Система следит за запасами еды и прогнозировать расход                                                                                                                                                                                         |
| Система делает пересчёт животных                                                                                                                                                                                                               |
| Система поддерживает необходимое количество видеокамер для аналитики в реальном времени от разных производителей                                                                                                                               |
| Система построена по принципу «центральный сервер — агенты» на конкретных фермах без ограничения количества таких агентов (в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью) |
| Система предоставляет базовые метрики для передачи в другие системы                                                                                                                                                                            |
| Система поддерживает возможность добавления собственных метрик                                                                                                                                                                                 |
| Система работает даже в случае отсутствия интернета и при необходимости отправлять уведомления дежурному сотруднику на местах мониторинга, а после восстановления связи синхронизироваться с центральной системой                              |
| Система имеет разделение ролей и поддерживать современные способы аутентификации и авторизации                                                                                                                                                 |
| Система имеет API для создания мобильного приложения или веб-приложения                                                                                                                                                                        |


| **№** | **Действующие лица или системы** | **Use Case** | **Описание**                                                                                                                |
|:-----:|:---------------------------------|:-------------|:----------------------------------------------------------------------------------------------------------------------------|
|   1   | Система                          | UC-01        | Система осуществляет мониторинг за животными                                                                                |
|   2   | Система                          | UC-02        | Система осуществляет мониторинг и управление устройствами кормления                                                         |
|   3   | Система                          | UC-03        | Система поддерживает множество камер от разных производителей                                                               |
|   4   | Система                          | UC-04        | Система предоставляет метрики для передачи в другие системы                                                                 |
|   5   | Система                          | UC-05        | Система поддерживает возможность добавления собственных метрик                                                              |
|   6   | Система                          | UC-06        | Система работает даже в случае отсутствия интернета, а после восстановления связи синхронизироваться с центральной системой |
|   7   | Система                          | UC-07        | Система отправлять уведомления дежурному сотруднику на местах мониторинга                                                   |
|   8   | Система                          | UC-08        | Система имеет разделение ролей и поддерживает современные способы аутентификации и авторизации                              |
|   9   | Система                          | UC-09        | Система имеет API для создания мобильного приложения или веб-приложения                                                     |


### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

| **№** | **Требование**                                                                                                                                                                                    |
|:-----:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|   1   | Система должна обеспечивать достаточно высокую отказоустойчивость 99,95%                                                                                                                          |
|   2   | Система должна быть расширяемой, то есть иметь возможность разработать новый функционал без изменений существующего                                                                               |
|   3   | Система должна иметь высокую производительность — от момента возникновения нештатной ситуации, зафиксированной с помощью видеоаналитики, должно проходить не более 5 секунд до момента оповещения |
|   4   | Система должна позволять системе видеоаналитики реагировать в реальном времени (миллисекунды)                                                                                                     |

### Что нужно учесть
Нейронные сети
- Часто нейронные сети путают тень животного с самим животным — для MVP не критично.
- Проблемы с освещением — камеры должны уметь снимать и в ночное время суток.
- Трекинг животных достаточно сложен, так как особи очень похожи.
- Готовую нейросетевую модель предоставят партнёры.

Инфраструктура:
- На ферме нестабильный WiFi, поэтому нужно продумать альтернативные каналы связи.
- Покрытие камерами всей площади — нужно по максимуму убрать слепые зоны либо воспользоваться камерами типа «рыбий глаз», но это снизит качество в силу выпуклости линзы.
- На каждой ферме допустимо использовать один центральный сервер и необходимый набор edge-устройств.

### <a name="_qmphm5d6rvi3"></a>**Решение**
Диаграмма контейнеров C2 приведена в файле [С2_AgroTech_Context_Distributed.puml](%D0%A12_AgroTech_Context_Distributed.puml)

#### 1. Интеграция сервер-агента и центрального сервера
Интеграция будет строиться по принципу pub\sub через существующий Apache Kafka, который находится в контуре АгроТех
Таким образом можно будет реализовать паттерн OutBox для доставки данных в случае прерывания связи между сервером-агентом и центральным сервером в офисе
Взаимодействие между веб-приложениями будет происходить через REST API

##### Плюсы:
- Позволяет передавать большой объем сообщений\событий
- Имеет распределенную архитектуру
- Распространенный сервис

##### Минусы и риски:

#### 2. Интеграция с потоком данных с устройств для аналитики
Поток данных с устройств для аналитики планируется получать с существующего IoT-контура.
Предполагаем что поток данных будем получать через gRPC-клиент

##### Плюсы:
- Позволяет использовать существующий контур IoT
- gRPC позволяет эффективно получать медиа-поток
- Поддерживает сжатие данных
- Распространенный протокол

##### Минусы и риски:

#### 3. База данных
Использовать будем PostgreSQL

##### Плюсы:
- Производительная OLTP БД
- Может быть распределенной
- Распространенная БД

##### Минусы и риски:

#### 4. Взаимодействие и управление устройствами
Будем использовать для отправки команд IoT-устройствам через существующий брокер сообщений Apache Kafka в контуре АгроТех

##### Плюсы:
- Брокер уже существует и связан с IoT-системой

##### Минусы и риски:

#### 5. Взаимодействие с веб-приложениями
Для взаимодействия с веб-приложениями решения будем использовать REST API

##### Плюсы:
- Является одним из требований

##### Минусы и риски:


### <a name="_bjrr7veeh80c"></a>**Альтернативы**

Альтернативная диаграмма контейнеров C2 приведена в файле [С2_AgroTech_Context_Centralized.puml](%D0%A12_AgroTech_Context_Centralized.puml)

Представлена централизованная реализация, где сервер\серверы находится в центральном офисе, куда будут подключены все фермы

#### 1. Интеграция сервер-агента и центрального сервера

Не требуется


##### Плюсы:
- Не требуется
- Быстрая реализация

##### Минусы и риски:
- Не соответствует требованиям
- Менее устойчивая реализация

#### 2. Интеграция с потоком данных с устройств для аналитики
Поток данных с устройств для аналитики планируется получать с существующего IoT-контура.
Предполагаем что поток данных будем получать через gRPC-клиент

##### Плюсы:
- Позволяет использовать существующий контур IoT
- gRPC позволяет эффективно получать медиа-поток
- Поддерживает сжатие данных
- Распространенный протокол

##### Минусы и риски:

#### 3. База данных
В качестве альтернативны можно использовать MySQL

##### Плюсы:
- Производительная OLTP БД
- Может быть распределенной
- Распространенная БД

##### Минусы и риски:

#### 4. Взаимодействие и управление устройствами
Реализовать взаимодействие с текущим IoT-контуром через RabbitMQ

##### Плюсы:
- Распространенный инструмент
- Можно управлять изолированно от остальных существующих решений
- не требовательна к ресурсам;
- поддаётся кластеризации.

##### Минусы и риски:


##### Минусы и риски: